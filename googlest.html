<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>A Piece of Life - Google Maps UI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --border: #efefef; --active: #000; --inactive: #8e8e93; --theme-color: #1a73e8; }
        body { font-family: 'Inter', sans-serif; background: #f0f0f0; margin: 0; display: flex; flex-direction: column; align-items: center; }
        
        #diary-wrapper { padding: 20px 0; }
        #diary-container { 
            width: 340px; height: 520px; background: #fff; position: relative; 
            overflow: hidden; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
        }

        /* ì‚¬ì§„ ì˜ì—­ & ìƒë‹¨ ì•„ì´ì½˜ */
        #photo-viewport { width: 100%; height: 62%; overflow: hidden; position: relative; background: #eee; }
        #main-photo { width: 100%; height: auto; display: block; }
        
        .top-icons { position: absolute; top: 15px; width: 100%; display: flex; justify-content: space-between; padding: 0 15px; box-sizing: border-box; z-index: 30; pointer-events: none; }
        .icon-circle { 
            width: 32px; height: 32px; background: rgba(0,0,0,0.4); border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; color: #fff; font-size: 16px; pointer-events: auto;
        }
        .right-icons { display: flex; gap: 8px; }

        /* ë°”í…€ ì‹œíŠ¸ ì •ë³´ì°½ */
        #bottom-sheet { 
            width: 100%; height: 38%; background: #fff; position: absolute; bottom: 0; 
            border-top-left-radius: 20px; border-top-right-radius: 20px; 
            box-shadow: 0 -5px 15px rgba(0,0,0,0.05); padding: 12px 20px; box-sizing: border-box; z-index: 20;
        }
        .handle { width: 36px; height: 4px; background: #e0e0e0; border-radius: 2px; margin: 0 auto 12px; }
        
        #info-title { font-size: 19px; font-weight: 700; margin-bottom: 3px; color: #202124; display: flex; justify-content: space-between; align-items: center; }
        #info-stats { display: flex; align-items: center; font-size: 13px; color: #70757a; margin-bottom: 5px; }
        .stars { color: #fbbc04; margin-right: 4px; letter-spacing: -1px; font-size: 14px; }
        #info-desc { font-size: 13px; color: #3c4043; margin-bottom: 3px; }
        #info-status { font-size: 13px; color: var(--theme-color); font-weight: 600; }

        #map-actions { display: flex; gap: 8px; margin-top: 15px; overflow-x: auto; padding-bottom: 5px; -webkit-overflow-scrolling: touch; }
        .action-btn { 
            flex-shrink: 0; border: 1px solid #dadce0; border-radius: 20px; 
            padding: 6px 14px; font-size: 12px; font-weight: 600; color: var(--theme-color); 
            display: flex; align-items: center; gap: 6px; white-space: nowrap;
        }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .tab-bar { width: 100%; max-width: 400px; display: flex; border-top: 0.5px solid var(--border); position: fixed; bottom: 0; background: #fff; z-index: 100; }
        .tab-item { flex: 1; padding: 15px 0; text-align: center; font-size: 9px; font-weight: 700; color: var(--inactive); cursor: pointer; }
        .tab-item.active { color: var(--active); }
        .panel { display: none; width: 340px; padding: 10px 0 120px 0; }
        .panel.active { display: block; }
        .control-row { display: flex; gap: 6px; justify-content: center; margin-bottom: 8px; align-items: center; }
        .circle-btn { width: 42px; height: 42px; border-radius: 50%; border: 1px solid var(--border); background: #fff; font-size: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .circle-btn.on { background: #000; color: #fff; }
        
        input[type="text"] { width: 85%; padding: 9px; border: 1px solid #ddd; border-radius: 8px; font-size: 12px; outline: none; }
    </style>
</head>
<body data-tab="photo">

<div id="diary-wrapper">
    <div id="diary-container">
        <div id="photo-viewport">
            <div class="top-icons">
                <div class="icon-circle">ã€ˆ</div>
                <div class="right-icons">
                    <div class="icon-circle">ğŸ“¤</div>
                    <div class="icon-circle">â‹¯</div>
                </div>
            </div>
            <img id="main-photo" class="draggable" src="" crossorigin="anonymous">
        </div>

        <div id="bottom-sheet">
            <div class="handle"></div>
            <div id="info-title">
                <span>ì¦ê±°ìš´ ìš°ë¦¬ì§‘</span>
                <span style="font-size: 18px; color:#70757a;">âœ•</span>
            </div>
            <div id="info-stats">
                <span id="info-rating-num" style="margin-right:4px; font-weight:bold; color:#202124;">4.8</span>
                <span class="stars" id="info-stars">â˜…â˜…â˜…â˜…â˜…</span>
                <span id="info-reviews">(466)</span>
            </div>
            <div id="info-desc">í‰í™”ë¡œìš´ ì‹ë‹¹ Â· ê°€ê²©: 12,000~23,000</div>
            <div id="info-status">ì˜ì—… ì¤‘ Â· ì˜¤í›„ 10:00ì— ì˜ì—… ì¢…ë£Œ</div>

            <div id="map-actions">
                <div class="action-btn">ğŸ—º ê²½ë¡œ</div>
                <div class="action-btn">ğŸ“ í†µí™”</div>
                <div class="action-btn">ğŸ“ ë””ë ‰í† ë¦¬</div>
                <div class="action-btn">ğŸ”– ì €ì¥</div>
            </div>
        </div>
    </div>
</div>

<div id="panel-photo" class="panel active">
    <div class="control-row">
        <input type="file" id="file-input" style="display:none" accept="image/*">
        <button class="circle-btn" onclick="document.getElementById('file-input').click()">ì´ë¯¸ì§€</button>
        <button class="circle-btn" onclick="setFilter('none')">ì›ë³¸</button>
        <button class="circle-btn" onclick="setFilter('bw')">í‘ë°±</button>
        <button class="circle-btn" onclick="setFilter('warm')">ë”°ëœ»í•¨</button>
    </div>
    <div class="control-row">
        <label style="font-size:10px">ë°ê¸°</label>
        <input type="range" id="br-range" min="0.5" max="1.5" step="0.01" value="1" oninput="applyFilter()">
    </div>
</div>

<div id="panel-info" class="panel">
    <div class="control-row"><input type="text" id="edit-title" placeholder="ì¥ì†Œëª… ìˆ˜ì •" oninput="updateInfo()"></div>
    <div class="control-row">
        <input type="text" id="edit-rating" style="width:20%" placeholder="4.8" oninput="updateInfo()">
        <input type="text" id="edit-reviews" style="width:30%" placeholder="(466)" oninput="updateInfo()">
        <input type="color" id="edit-color" value="#1a73e8" oninput="updateThemeColor(this.value)" style="width:35px; height:35px; border:none; background:none; cursor:pointer;">
    </div>
    <div class="control-row">
        <button class="circle-btn" onclick="setStars(1)">1â˜…</button>
        <button class="circle-btn" onclick="setStars(2)">2â˜…</button>
        <button class="circle-btn" onclick="setStars(3)">3â˜…</button>
        <button class="circle-btn" onclick="setStars(4)">4â˜…</button>
        <button class="circle-btn" onclick="setStars(5)">5â˜…</button>
    </div>
    <div class="control-row"><input type="text" id="edit-desc" placeholder="ì„¤ëª… (ì¹´í…Œê³ ë¦¬ Â· ê°€ê²©)" oninput="updateInfo()"></div>
    <div class="control-row"><input type="text" id="edit-status" placeholder="ì˜ì—… ìƒíƒœ ì •ë³´" oninput="updateInfo()"></div>
</div>

<div id="panel-save" class="panel">
    <div class="control-row">
        <button class="circle-btn" style="background:#000; color:#fff; width:150px; border-radius:12px; font-weight:bold;" onclick="saveMap()">ì™„ì„± ì´ë¯¸ì§€ ì €ì¥</button>
    </div>
</div>

<nav class="tab-bar">
    <div class="tab-item active" onclick="switchTab('photo', this)">1. PHOTO</div>
    <div class="tab-item" onclick="switchTab('info', this)">2. INFO</div>
    <div class="tab-item" onclick="switchTab('save', this)">3. SAVE</div>
</nav>

<script>
    let originalImg = null;
    let filterType = 'none';

    function switchTab(n, e) {
        document.body.setAttribute('data-tab', n);
        document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
        e.classList.add('active');
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        document.getElementById('panel-' + n).classList.add('active');
    }

    // ì‚¬ì§„ í•„í„° & ë°ê¸° (ì‹¤ì‹œê°„ ìº”ë²„ìŠ¤ êµ½ê¸° ë°©ì‹)
    document.getElementById('file-input').onchange = (e) => {
        const reader = new FileReader();
        reader.onload = (ev) => {
            const img = new Image();
            img.onload = () => { originalImg = img; applyFilter(); };
            img.src = ev.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
    };

    function setFilter(t) { filterType = t; applyFilter(); }
    function applyFilter() {
        if (!originalImg) return;
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = originalImg.width;
        canvas.height = originalImg.height;
        const br = document.getElementById('br-range').value;
        
        let filterStr = `brightness(${br})`;
        if(filterType === 'bw') filterStr += ' grayscale(1)';
        if(filterType === 'warm') filterStr += ' sepia(0.3) saturate(1.2)';
        
        ctx.filter = filterStr;
        ctx.drawImage(originalImg, 0, 0);
        document.getElementById('main-photo').src = canvas.toDataURL("image/jpeg", 0.95);
    }

    // ë³„ì  ë° ì •ë³´ ì—…ë°ì´íŠ¸
    function setStars(n) {
        document.getElementById('info-stars').innerText = "â˜…".repeat(n) + "â˜†".repeat(5-n);
        // ë³„ì ì— ë§ì¶° ìˆ«ìë„ ìë™ ë³€ê²½ë˜ê²Œ í•˜ë ¤ë©´ ì•„ë˜ ì£¼ì„ í•´ì œ
        // document.getElementById('info-rating-num').innerText = n + ".0";
    }

    function updateInfo() {
        document.getElementById('info-title').firstElementChild.innerText = document.getElementById('edit-title').value || "ì¼ë³¸ ìš°ë™ì§‘";
        document.getElementById('info-rating-num').innerText = document.getElementById('edit-rating').value || "4.8";
        document.getElementById('info-reviews').innerText = document.getElementById('edit-reviews').value || "(466)";
        document.getElementById('info-desc').innerText = document.getElementById('edit-desc').value || "ëˆê¹ŒìŠ¤ ì „ë¬¸ì‹ë‹¹ Â· Â¥2,000~3,000";
        document.getElementById('info-status').innerText = document.getElementById('edit-status').value || "ì˜ì—… ì¤‘ Â· ì˜¤í›„ 10:00ì— ì˜ì—… ì¢…ë£Œ";
    }

    function updateThemeColor(val) {
        document.documentElement.style.setProperty('--theme-color', val);
    }

    // ì €ì¥ (í•„í„° ë°˜ì˜ í™•ì‹¤íˆ ë˜ë„ë¡)
    function saveMap() {
        const target = document.getElementById('diary-container');
        html2canvas(target, { 
            scale: 3, 
            useCORS: true,
            allowTaint: true,
            backgroundColor: "#ffffff"
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = `GoogleMaps_Diary_${Date.now()}.png`;
            link.href = canvas.toDataURL("image/png");
            link.click();
        });
    }

    // InteractJS
    function initInteract(el) {
        let x = 0, y = 0, s = 1;
        interact(el).draggable({
            onmove: (e) => {
                x += e.dx; y += e.dy;
                e.target.style.transform = `translate(${x}px, ${y}px) scale(${s})`;
            }
        }).gesturable({
            onmove: (e) => {
                s *= (1 + e.ds);
                e.target.style.transform = `translate(${x}px, ${y}px) scale(${s})`;
            }
        });
    }
    initInteract(document.getElementById('main-photo'));
</script>
</body>
</html>